{% extends 'layouts/base.html' %}
{% block title %}WGS Data Overview{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="header bg-primary pb-6" style="min-height: 200px; background-image: url(/static/assets/img/theme/viruses.jpg); background-size: cover; background-position: center center;">
  <span class="mask bg-gradient-default opacity-6"></span>
  <div class="container-fluid">
    <div class="header-body">
      <div class="row align-items-center py-4">
        <div class="col-lg-6 col-7">
          <h6 class="h2 text-white d-inline-block mb-0">Referred Isolates Database</h6>
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
            <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
              <li class="breadcrumb-item"><a href="{% url 'home' %}"><i class="fas fa-home"></i></a></li>
              <li class="breadcrumb-item active" aria-current="page">WGS Data Overview</li>
            </ol>
          </nav>
        </div>
        <div class="col-lg-6 col-5 text-right">
          <a class="btn btn-sm btn-neutral" href="{% url 'batch_create_view' %}">New Batch</a>
          <a class="btn btn-sm btn-neutral" href="{% url 'upload_wgs_view' %}">Upload Data</a>
          <a href="{% url 'download_matched_wgs_data' %}" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#downloadModal">Download WGS Data</a>
              <!-- <button class="btn btn-success" data-toggle="modal" data-target="#downloadModal">
             Download WGS Data
            </button> -->
          <button class="btn btn-sm btn-neutral" onclick="history.back()">Back</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container-fluid mt--6">
  <div class="card shadow">
    <div class="card-header bg-gradient-primary border-0">
      <div class="row align-items-center">
        <div class="col">
          <h3 class="mb-0 text-white">
            <i class="ni ni-atom mr-2"></i>WGS Data Overview
          </h3>
        </div>
        <div class="col text-right">
          <span class="text-white">
            <strong>{{ table_data|length }}</strong> Accession(s) in Total
          </span>
        </div>
      </div>
    </div>
    
    <div class="card-body">
      <!-- Filter Section -->
      <div class="row mb-4">
        <div class="col-12">

          <div class="d-flex align-items-center justify-content-between flex-wrap">
            <h5 class="mb-0"><i class="ni ni-ui-04 mr-2"></i>Filter by Data Type:</h5>
            <div class="d-flex gap-2 flex-wrap">
              <button class="btn btn-sm btn-outline-success filter-btn" data-filter="fastq">
                <i class="ni ni-cloud-upload-96 mr-1"></i>FastQ
              </button>
              <button class="btn btn-sm btn-outline-primary filter-btn" data-filter="gambit">
                <i class="ni ni-chart-bar-32 mr-1"></i>Gambit
              </button>
              <button class="btn btn-sm btn-outline-warning filter-btn" data-filter="mlst">
                <i class="ni ni-atom mr-1"></i>MLST
              </button>
              <button class="btn btn-sm btn-outline-info filter-btn" data-filter="checkm2">
                <i class="ni ni-check-bold mr-1"></i>CheckM2
              </button>
              <button class="btn btn-sm btn-outline-danger filter-btn" data-filter="assembly">
                <i class="ni ni-settings mr-1"></i>Assembly
              </button>
              <button class="btn btn-sm filter-btn" data-filter="amrfinder" style="border-color: #8965e0; color: #4c1e6b;">
                <i class="ni ni-lock-circle-open mr-1"></i>AMRFinder
              </button>
              <button class="btn btn-sm btn-secondary" id="clear-filter">
                <i class="ni ni-fat-remove mr-1"></i>Clear Filter
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="table-responsive" style="max-height: 550px; overflow-y: auto;">
        <table class="table table-hover table-flush align-middle mb-0" id="wgs-table" style="max-height: 500px;  overflow-x: auto;">
          <thead class="thead-light">
            <tr class="text-center">
              <th class="text-left">Accession No</th>
              <th><i class="ni ni-cloud-upload-96 text-success"></i> FastQ</th>
              <th><i class="ni ni-chart-bar-32 text-primary"></i> Gambit</th>
              <th><i class="ni ni-atom text-warning"></i> MLST</th>
              <th><i class="ni ni-check-bold text-info"></i> CheckM2</th>
              <th><i class="ni ni-settings text-danger"></i> Assembly</th>
              <th><i class="ni ni-lock-circle-open text-purple"></i> AMRFinder</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            
            {% for entry in table_data %}

            <tr class="text-center data-row" 
                data-fastq="{% if entry.summary_flags.fastq %}true{% else %}false{% endif %}"
                data-gambit="{% if entry.summary_flags.gambit %}true{% else %}false{% endif %}"
                data-mlst="{% if entry.summary_flags.mlst %}true{% else %}false{% endif %}"
                data-checkm2="{% if entry.summary_flags.checkm2 %}true{% else %}false{% endif %}"
                data-assembly="{% if entry.summary_flags.assembly %}true{% else %}false{% endif %}"
                data-amrfinder="{% if entry.summary_flags.amrfinder %}true{% else %}false{% endif %}">
              <td class="text-left">
                <strong class="text-primary">{{ entry.accession }}</strong>
              </td>
              <td>
                {% if entry.summary_flags.fastq %}
                  <span class="badge badge-success">✓</span>
                {% else %}
                  <span class="badge badge-light">—</span>
                {% endif %}
              </td>
              <td>
                {% if entry.summary_flags.gambit %}
                  <span class="badge badge-success">✓</span>
                {% else %}
                  <span class="badge badge-light">—</span>
                {% endif %}
              </td>
              <td>
                {% if entry.summary_flags.mlst %}
                  <span class="badge badge-success">✓</span>
                {% else %}
                  <span class="badge badge-light">—</span>
                {% endif %}
              </td>
              <td>
                {% if entry.summary_flags.checkm2 %}
                  <span class="badge badge-success">✓</span>
                {% else %}
                  <span class="badge badge-light">—</span>
                {% endif %}
              </td>
              <td>
                {% if entry.summary_flags.assembly %}
                  <span class="badge badge-success">✓</span>
                {% else %}
                  <span class="badge badge-light">—</span>
                {% endif %}
              </td>
              <td>
                {% if entry.summary_flags.amrfinder %}
                  <span class="badge badge-success">✓</span>
                {% else %}
                  <span class="badge badge-light">—</span>
                {% endif %}
              </td>
              <td>
                <button class="btn btn-sm btn-primary toggle-view-btn" type="button" 
                        data-toggle="collapse" 
                        data-target="#details{{ forloop.counter }}"
                        aria-expanded="false">
                  <i class="ni ni-zoom-split-in"></i> <span class="btn-text">View</span>
                </button>
              </td>
            </tr>

            <!-- Expandable Details Row -->
            <tr class="collapse detail-row" id="details{{ forloop.counter }}"
                data-referred="{% if entry.summary_flags.fastq or entry.summary_flags.gambit or entry.summary_flags.mlst or entry.summary_flags.checkm2 or entry.summary_flags.assembly or entry.summary_flags.amrfinder %}true{% else %}false{% endif %}"
                data-fastq="{% if entry.summary_flags.fastq %}true{% else %}false{% endif %}"
                data-gambit="{% if entry.summary_flags.gambit %}true{% else %}false{% endif %}"
                data-mlst="{% if entry.summary_flags.mlst %}true{% else %}false{% endif %}"
                data-checkm2="{% if entry.summary_flags.checkm2 %}true{% else %}false{% endif %}"
                data-assembly="{% if entry.summary_flags.assembly %}true{% else %}false{% endif %}"
                data-amrfinder="{% if entry.summary_flags.amrfinder %}true{% else %}false{% endif %}">

              <td colspan="8" class="p-4" style="background-color: #f7fafc;">
                <div class="row">
                 <!-- Isolate Details Card -->
{% if entry.related_data %}
<div class="col-12 mb-4">
  <div class="card mb-0 shadow-sm">
    <div class="card-header py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <h5 class="mb-0 text-white">
        <i class="ni ni-single-copy-04 mr-2"></i>Referred Isolate Information
      </h5>
    </div>
    <div class="card-body p-4">
      
      <!-- Identification Section -->
      <div class="info-section mb-4">
        <h6 class="section-title mb-3">
          <i class="ni ni-badge text-primary mr-2"></i>Identification
        </h6>
        <div class="row">
          <div class="col-md-4">
            <div class="info-item">
              <label>Accession No:</label>
              <p class="info-value text-danger font-weight-bold">{{ entry.accession }}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-item">
              <label>Referral Date:</label>
              <p class="info-value">{{ entry.referral_date|date:"F j, Y" }}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-item">
              <label>Patient ID:</label>
              <p class="info-value">{{ entry.patient_id|default:"N/A" }}</p>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <!-- Specimen Details Section -->
      <div class="info-section mb-4">
        <h6 class="section-title mb-3">
          <i class="ni ni-album-2 text-success mr-2"></i>Specimen Details
        </h6>
        <div class="row">
          <div class="col-md-4">
            <div class="info-item">
              <label>Specimen Type:</label>
              <p class="info-value">{{ entry.specimen|default:"N/A" }}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-item">
              <label>Collection Date:</label>
              <p class="info-value">{{ entry.date_collected|date:"F j, Y"|default:"N/A" }}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-item">
              <label>Growth:</label>
              <p class="info-value">
                {% if entry.growth %}
                  <span class="badge badge-success">{{ entry.growth }}</span>
                {% else %}
                  <span class="badge badge-secondary">N/A</span>
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <!-- Patient Information Section -->
      <div class="info-section mb-4">
        <h6 class="section-title mb-3">
          <i class="ni ni-single-02 text-info mr-2"></i>Patient Information
        </h6>
        <div class="row">
          <div class="col-md-6">
            <div class="info-item">
              <label>Patient Name:</label>
              <p class="info-value">{{ entry.patient_name|default:"N/A" }}</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="info-item">
              <label>Sex:</label>
              <p class="info-value">
                {% if entry.sex == 'M' %}
                  <span class="badge badge-info">Male</span>
                {% elif entry.sex == 'F' %}
                  <span class="badge badge-pink">Female</span>
                {% else %}
                  <span class="badge badge-secondary">{{ entry.sex|default:"N/A" }}</span>
                {% endif %}
              </p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="info-item">
              <label>Age:</label>
              <p class="info-value">
                <span class="badge badge-primary">{{ entry.age|default:"N/A" }}</span>
              </p>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-md-6">
            <div class="info-item">
              <label>Ward/Location:</label>
              <p class="info-value">{{ entry.ward|default:"N/A" }}</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="info-item">
              <label>Site/Hospital:</label>
              <p class="info-value">{{ entry.site_name|default:"N/A" }}</p>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <!-- Clinical Information Section -->
      <div class="info-section">
        <h6 class="section-title mb-3">
          <i class="ni ni-chart-pie-35 text-warning mr-2"></i>Clinical & Laboratory Findings
        </h6>
        <div class="row">
          <div class="col-md-4">
            <div class="info-item">
              <label>Organism Identified:</label>
              <p class="info-value font-weight-bold text-primary">{{ entry.organism|default:"N/A" }}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-item">
              <label>Referring Laboratory:</label>
              <p class="info-value">{{ entry.referring_lab|default:"N/A" }}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-item">
              <label>Status:</label>
              <p class="info-value">
                {% if entry.status %}
                  <span class="badge badge-success">{{ entry.status }}</span>
                {% else %}
                  <span class="badge badge-secondary">N/A</span>
                {% endif %}
              </p>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-md-12">
            <div class="info-item">
              <label>Clinical Notes:</label>
              <p class="info-value text-muted">{{ entry.clinical_notes|default:"No additional notes" }}</p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
{% endif %}
                  <!-- FastQ Data -->
                  {% if entry.related_data.fastq %}
                  <div class="col-12 mb-4">
                    <div class="card mb-0">
                      <div class="card-header bg-gradient-success py-2">
                        <h5 class="mb-0 text-white">
                          <i class="ni ni-cloud-upload-96 mr-2"></i>FastQ Summary 
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="table-responsive" style="max-height: 500px;  overflow-y: auto; overflow-x: auto;">

                          <table class="table table-sm table-bordered mb-0">
                            <thead class="thead-light">
                              <tr>
                                <th>Sample</th>
                                <th>Sequencing</th>
                                <th>Before Reads</th>
                                <th>After Reads</th>
                                <th>Q30 Rate</th>
                                <th>GC Content</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for f in entry.related_data.fastq %}
                              <tr>
                                <td>{{ f.sample|default:"N/A" }}</td>
                                <td>{{ f.sequencing|default:"N/A" }}</td>
                                <td>{{ f.before_total_reads|default:"N/A" }}</td>
                                <td>{{ f.after_total_reads|default:"N/A" }}</td>
                                <td>{{ f.post_trim_q30_rate|default:"N/A" }}</td>
                                <td>{{ f.after_gc_content|default:"N/A" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- Gambit Data -->
                  {% if entry.related_data.gambit %}
                  <div class="col-12 mb-4">
                    <div class="card mb-0">
                      <div class="card-header bg-gradient-primary py-2">
                        <h5 class="mb-0 text-white">
                          <i class="ni ni-chart-bar-32 mr-2"></i>Gambit Summary
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="table-responsive" style="max-height: 500px;  overflow-y: auto; overflow-x: auto;">
                          <table class="table table-sm table-bordered mb-0">
                            <thead class="thead-light">
                              <tr>
                                <th>Sample</th>
                                <th>Predicted Name</th>
                                <th>Closest Genomes</th>
                                <th>Distance</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for g in entry.related_data.gambit %}
                              <tr>
                                <td>{{ g.sample|default:"N/A" }}</td>
                                <td>{{ g.predicted_name|default:"N/A" }}</td>
                                <td>{{ g.closest_genomes|default:"N/A" }}</td>
                                <td>{{ g.closest_distance|default:"N/A" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- MLST Data -->
                  {% if entry.related_data.mlst %}
                  <div class="col-12 mb-4">
                    <div class="card mb-0">
                      <div class="card-header bg-gradient-warning py-2">
                        <h5 class="mb-0 text-white">
                          <i class="ni ni-atom mr-2"></i>MLST Summary
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="table-responsive" style="max-height: 500px;  overflow-y: auto; overflow-x: auto;">
                          <table class="table table-sm table-bordered mb-0">
                            <thead class="thead-light">
                              <tr>
                                <th>Name</th>
                                <th>Scheme</th>
                                <th>MLST</th>
                                <th>Alleles</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for m in entry.related_data.mlst %}
                              <tr>
                                <td>{{ m.name|default:"N/A" }}</td>
                                <td>{{ m.scheme|default:"N/A" }}</td>
                                <td>{{ m.mlst|default:"N/A" }}</td>
                                <td>{{ m.alleles|default:"N/A" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- CheckM2 Data -->
                  {% if entry.related_data.checkm2 %}
                  <div class="col-12 mb-4">
                    <div class="card mb-0">
                      <div class="card-header bg-gradient-info py-2">
                        <h5 class="mb-0 text-white">
                          <i class="ni ni-check-bold mr-2"></i>CheckM2 Summary
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="table-responsive" style="max-height: 500px;  overflow-y: auto; overflow-x: auto;">
                          <table class="table table-sm table-bordered mb-0">
                            <thead class="thead-light">
                              <tr>
                                <th>Name</th>
                                <th>Completeness (%)</th>
                                <th>Contamination (%)</th>
                                <th>Quality Score</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for c in entry.related_data.checkm2 %}
                              <tr>
                                <td>{{ c.Name|default:"N/A" }}</td>
                                <td>{{ c.Completeness|default:"N/A" }}</td>
                                <td>{{ c.Contamination|default:"N/A" }}</td>
                                <td>{{ c.quality|default:"N/A" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- Assembly Data -->
                  {% if entry.related_data.assembly %}
                  <div class="col-12 mb-4">
                    <div class="card mb-0">
                      <div class="card-header bg-gradient-danger py-2">
                        <h5 class="mb-0 text-white">
                          <i class="ni ni-settings mr-2"></i>Assembly Summary
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="table-responsive" style="max-height: 500px;  overflow-y: auto; overflow-x: auto;">
                          <table class="table table-sm table-bordered mb-0">
                            <thead class="thead-light">
                              <tr>
                                <th>Sample</th>
                                <th>Total Contigs</th>
                                <th>N50 Length</th>
                                <th>Total Length</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for a in entry.related_data.assembly %}
                              <tr>
                                <td>{{ a.sample|default:"N/A" }}</td>
                                <td>{{ a.total_contig|default:"N/A" }}</td>
                                <td>{{ a.n50_contig_length|default:"N/A" }}</td>
                                <td>{{ a.total_contig_length|default:"N/A" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- AMRFinder Data -->
                  {% if entry.related_data.amrfinder %}
                  <div class="col-12 mb-4">
                    <div class="card mb-0">
                      <div class="card-header py-2" style="background: linear-gradient(135deg, #8965e0 0%, #bc65e0 100%);">
                        <h5 class="mb-0 text-white">
                          <i class="ni ni-lock-circle-open mr-2"></i>AMRFinder Summary
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="table-responsive" style="max-height: 500px;  overflow-y: auto; overflow-x: auto;">
                          <table class="table table-sm table-bordered mb-0">
                            <thead class="thead-light">
                              <tr>
                                <th>Name</th>
                                <th>Gene Symbol</th>
                                <th>Class</th>
                                <th>Subclass</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for a in entry.related_data.amrfinder %}
                              <tr>
                                <td>{{ a.name|default:"N/A" }}</td>
                                <td>{{ a.element_symbol|default:"N/A" }}</td>
                                <td>{{ a.class_field|default:"N/A" }}</td>
                                <td>{{ a.subclass|default:"N/A" }}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- No Data Message -->
                  {% if not entry.related_data.fastq and not entry.related_data.gambit and not entry.related_data.mlst and not entry.related_data.checkm2 and not entry.related_data.assembly and not entry.related_data.amrfinder %}
                  <div class="col-12">
                    <div class="alert alert-info mb-0">
                      <i class="ni ni-notification-70 mr-2"></i>
                      No detailed WGS data available for this accession.
                    </div>
                  </div>
                  {% endif %}

                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center py-5">
                <i class="ni ni-folder-17 text-muted" style="font-size: 3rem;"></i>
                <p class="text-muted mt-3 mb-0">No WGS data found</p>
              </td>
            </tr>
            {% endfor %}


          </tbody>

        </table>
      

              <!-- Download Selection Modal -->
        <div class="modal fade" id="downloadModal" tabindex="-1" role="dialog" aria-labelledby="downloadModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content shadow-lg border-0">
              <div class="modal-header bg-gradient-primary text-white">
                <h5 class="modal-title" id="downloadModalLabel">Download WGS Data</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p class="text-muted mb-3">
                  Choose which type of WGS data you want to download:
                </p>
                <ul>
                  <li><strong>Complete Sets:</strong> Accessions found in <em>all</em> WGS tables (FastQ, MLST, CheckM2, Assembly, AMRFinder, Gambit)</li>
                  <li><strong>Partial Sets:</strong> Accessions found in <em>any</em> WGS table</li>
                </ul>
              </div>
              <div class="modal-footer justify-content-between">
                <a href="{% url 'download_all_wgs_data' %}?mode=all" class="btn btn-primary">
                  <i class="ni ni-check-bold"></i> Download Complete Sets
                </a>
                <a href="{% url 'download_matched_wgs_data' %}?mode=any" class="btn btn-success">
                  <i class="ni ni-cloud-download-95"></i> Download Partial Sets
                </a>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


<style>
.text-purple {
  color: #8965e0;
}

.badge-light {
  background-color: #e9ecef;
  color: #6c757d;
}

.collapse.show {
  background-color: #f7fafc;
}

.table-flush tbody tr:last-child td {
  border-bottom: 0;
}

.filter-btn.active {
  background-color: var(--btn-bg);
  color: white;
  border-color: var(--btn-bg);
}

.filter-btn[data-filter="fastq"].active {
  --btn-bg: #2dce89;
}

.filter-btn[data-filter="gambit"].active {
  --btn-bg: #5e72e4;
}

.filter-btn[data-filter="mlst"].active {
  --btn-bg: #fb6340;
}

.filter-btn[data-filter="checkm2"].active {
  --btn-bg: #11cdef;
}

.filter-btn[data-filter="assembly"].active {
  --btn-bg: #f5365c;
}

.filter-btn[data-filter="amrfinder"].active {
  --btn-bg: #8965e0;
  border-color: #8965e0;
}

.gap-2 {
  gap: 0.5rem;
}

/* Custom Styles for Isolate Details */
.info-section {
  background-color: #f8f9fa;
  padding: 1.5rem;
  border-radius: 8px;
  border-left: 4px solid #5e72e4;
}

.section-title {
  font-size: 1rem;
  font-weight: 600;
  color: #32325d;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
}

.info-item {
  margin-bottom: 1rem;
}

.info-item label {
  font-size: 0.875rem;
  font-weight: 600;
  color: #8898aa;
  margin-bottom: 0.25rem;
  display: block;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.info-value {
  font-size: 1rem;
  color: #32325d;
  margin-bottom: 0;
  font-weight: 500;
}

.badge-pink {
  background-color: #f3a4b5;
  color: white;
}

.info-section hr {
  margin: 1.5rem 0;
  border-top: 1px solid #dee2e6;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .info-section {
    padding: 1rem;
  }
  
  .section-title {
    font-size: 0.9rem;
  }
}

</style>


<!-- Toggling from View to Hide button and filter buttons -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterButtons = document.querySelectorAll('.filter-btn');
  const clearButton = document.getElementById('clear-filter');
  const dataRows = document.querySelectorAll('.data-row');
  const detailRows = document.querySelectorAll('.detail-row');
  const toggleButtons = document.querySelectorAll('.toggle-view-btn');
  
  let activeFilter = null;

  // Filter functionality for each filter buttons
  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      const filterType = this.getAttribute('data-filter');
      
      // Toggle active state
      if (activeFilter === filterType) {
        // Deactivate current filter
        activeFilter = null;
        this.classList.remove('active');
        showAllRows();
      } else {
        // Activate new filter
        filterButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        activeFilter = filterType;
        applyFilter(filterType);
      }
    });
  });

  clearButton.addEventListener('click', function() {
    activeFilter = null;
    filterButtons.forEach(btn => btn.classList.remove('active'));
    showAllRows();
  });

  // Toggle view button functionality
  toggleButtons.forEach((button, index) => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const targetId = this.getAttribute('data-target');
      const targetElement = document.querySelector(targetId);
      const isCurrentlyExpanded = targetElement && targetElement.classList.contains('show');
      
      // Toggle the collapse
      $(targetElement).collapse('toggle');
      
      const icon = this.querySelector('i');
      const text = this.querySelector('.btn-text');
      
      // Update button immediately
      if (isCurrentlyExpanded) {
        // Currently expanded, will collapse
        icon.className = 'ni ni-zoom-split-in';
        text.textContent = 'View';
        this.classList.remove('btn-secondary');
        this.classList.add('btn-primary');
      } else {
        // Currently collapsed, will expand
        icon.className = 'ni ni-zoom-split-out';
        text.textContent = 'Hide';
        this.classList.remove('btn-primary');
        this.classList.add('btn-secondary');
      }
    });
  });

  function applyFilter(filterType) {
    dataRows.forEach((row, index) => {
      const hasData = row.getAttribute(`data-${filterType}`) === 'true';
      const detailRow = detailRows[index];
      
      if (hasData) {
        row.style.display = '';
        if (detailRow) detailRow.style.display = '';
      } else {
        row.style.display = 'none';
        if (detailRow) {
          detailRow.style.display = 'none';
          // Close the detail if it's open
          $(detailRow).collapse('hide');
        }
      }
    });
    
    updateResultCount();
  }

  function showAllRows() {
    dataRows.forEach(row => row.style.display = '');
    detailRows.forEach(row => row.style.display = '');
    updateResultCount();
  }

  function updateResultCount() {
    const visibleRows = Array.from(dataRows).filter(row => row.style.display !== 'none');
    const countElement = document.querySelector('.card-header .text-right span');
    if (countElement) {
      countElement.innerHTML = `<strong>${visibleRows.length}</strong> Accession(s) ${activeFilter ? `with ${activeFilter.toUpperCase()}` : 'in Total'}`;
    }
  }
});
</script>

{% endblock %}